<!doctype html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="description" content="Orb2019 - $TEAMNAME"><meta name="lang:clipboard.copy" content="Copy to clipboard"><meta name="lang:clipboard.copied" content="Copied to clipboard"><meta name="lang:search.language" content="en"><meta name="lang:search.pipeline.stopwords" content="True"><meta name="lang:search.pipeline.trimmer" content="True"><meta name="lang:search.result.none" content="No matching documents"><meta name="lang:search.result.one" content="1 matching document"><meta name="lang:search.result.other" content="# matching documents"><meta name="lang:search.tokenizer" content="[\s\-]+"><link rel="shortcut icon" href="../assets/images/favicon.png"><meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.3.1"><title>Three - Orb2019 - $TEAMNAME</title><link rel="stylesheet" href="../assets/stylesheets/application.4031d38b.css"><script src="../assets/javascripts/modernizr.74668098.js"></script><link href="https://fonts.gstatic.com" rel="preconnect" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=swap"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel="stylesheet" href="../assets/fonts/material-icons.css"><link rel="stylesheet" href="../stylesheets/extra.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Gentium+Book+Basic"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"></head><body dir="ltr"><svg class="md-svg"><defs></defs></svg> <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off"> <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off"> <label class="md-overlay" data-md-component="overlay" for="__drawer"></label><a href="#milestone-3" tabindex="1" class="md-skip">Skip to content </a><header class="md-header" data-md-component="header"><nav class="md-header-nav md-grid"><div class="md-flex"><div class="md-flex__cell md-flex__cell--shrink"><a href=".." title="Orb2019 - $TEAMNAME" class="md-header-nav__button md-logo"><i class="md-icon"></i></a></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label></div><div class="md-flex__cell md-flex__cell--stretch"><div class="md-flex__ellipsis md-header-nav__title" data-md-component="title"><span class="md-header-nav__topic">Orb2019 - $TEAMNAME</span><span class="md-header-nav__topic">Three</span></div></div><div class="md-flex__cell md-flex__cell--shrink"></div></div></nav></header><div class="md-container"><main class="md-main"><div class="md-main__inner md-grid" data-md-component="container"><div class="md-sidebar md-sidebar--primary" data-md-component="navigation"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--primary" data-md-level="0"><label class="md-nav__title md-nav__title--site" for="__drawer"><a href=".." title="Orb2019 - $TEAMNAME" class="md-nav__button md-logo"><i class="md-icon"></i></a>Orb2019 - $TEAMNAME</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href=".." title="Home" class="md-nav__link">Home</a></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked><label class="md-nav__link" for="nav-2">Milestones</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-2">Milestones</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../milestone_one/" title="One" class="md-nav__link">One</a></li><li class="md-nav__item"><a href="../milestone_two/" title="Two" class="md-nav__link">Two</a></li><li class="md-nav__item md-nav__item--active"><input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc"><label class="md-nav__link md-nav__link--active" for="__toc">Three</label><a href="./" title="Three" class="md-nav__link md-nav__link--active">Three</a><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">Table of contents</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#1-site-design-revamped" title="1. Site Design Revamped" class="md-nav__link">1. Site Design Revamped</a></li><li class="md-nav__item"><a href="#2-calorie-counter" title="2. Calorie Counter" class="md-nav__link">2. Calorie Counter</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#21-typeaheadjs-technical-details" title="2.1 typeahead.js technical details" class="md-nav__link">2.1 typeahead.js technical details</a></li><li class="md-nav__item"><a href="#22-typeaheadjs-bug" title="2.2 typeahead.js bug" class="md-nav__link">2.2 typeahead.js bug</a></li><li class="md-nav__item"><a href="#23-input-validation" title="2.3 Input Validation" class="md-nav__link">2.3 Input Validation</a></li><li class="md-nav__item"><a href="#24-empty-rows" title="2.4 Empty Rows" class="md-nav__link">2.4 Empty Rows</a></li><li class="md-nav__item"><a href="#25-piechart-for-results" title="2.5 Piechart for Results" class="md-nav__link">2.5 Piechart for Results</a></li><li class="md-nav__item"><a href="#26-saving-recipes-to-database" title="2.6 Saving Recipes to Database" class="md-nav__link">2.6 Saving Recipes to Database</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#261-front-end" title="2.6.1 Front-end" class="md-nav__link">2.6.1 Front-end</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#delete" title=""Delete"" class="md-nav__link">"Delete"</a></li></ul></nav></li><li class="md-nav__item"><a href="#262-undo-functionality" title="2.6.2 Undo Functionality" class="md-nav__link">2.6.2 Undo Functionality</a></li><li class="md-nav__item"><a href="#263-back-end" title="2.6.3 Back-end" class="md-nav__link">2.6.3 Back-end</a></li></ul></nav></li></ul></nav></li><li class="md-nav__item"><a href="#3-user-accounts-and-sign-ins" title="3. User Accounts and Sign-ins" class="md-nav__link">3. User Accounts and Sign-ins</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#31-information-transfer" title="3.1 Information Transfer" class="md-nav__link">3.1 Information Transfer</a></li><li class="md-nav__item"><a href="#32-registration" title="3.2 Registration" class="md-nav__link">3.2 Registration</a></li><li class="md-nav__item"><a href="#33-logins" title="3.3 Logins" class="md-nav__link">3.3 Logins</a></li><li class="md-nav__item"><a href="#34-session-id" title="3.4 Session ID" class="md-nav__link">3.4 Session ID</a></li></ul></nav></li><li class="md-nav__item"><a href="#5-night-mode" title="5. Night Mode" class="md-nav__link">5. Night Mode</a></li><li class="md-nav__item"><a href="#6-conclusion-of-the-project" title="6. Conclusion of the Project" class="md-nav__link">6. Conclusion of the Project</a></li><li class="md-nav__item"><a href="#project-log" title="Project Log" class="md-nav__link">Project Log</a></li></ul></nav></li></ul></nav></li></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component="toc"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">Table of contents</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#1-site-design-revamped" title="1. Site Design Revamped" class="md-nav__link">1. Site Design Revamped</a></li><li class="md-nav__item"><a href="#2-calorie-counter" title="2. Calorie Counter" class="md-nav__link">2. Calorie Counter</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#21-typeaheadjs-technical-details" title="2.1 typeahead.js technical details" class="md-nav__link">2.1 typeahead.js technical details</a></li><li class="md-nav__item"><a href="#22-typeaheadjs-bug" title="2.2 typeahead.js bug" class="md-nav__link">2.2 typeahead.js bug</a></li><li class="md-nav__item"><a href="#23-input-validation" title="2.3 Input Validation" class="md-nav__link">2.3 Input Validation</a></li><li class="md-nav__item"><a href="#24-empty-rows" title="2.4 Empty Rows" class="md-nav__link">2.4 Empty Rows</a></li><li class="md-nav__item"><a href="#25-piechart-for-results" title="2.5 Piechart for Results" class="md-nav__link">2.5 Piechart for Results</a></li><li class="md-nav__item"><a href="#26-saving-recipes-to-database" title="2.6 Saving Recipes to Database" class="md-nav__link">2.6 Saving Recipes to Database</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#261-front-end" title="2.6.1 Front-end" class="md-nav__link">2.6.1 Front-end</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#delete" title=""Delete"" class="md-nav__link">"Delete"</a></li></ul></nav></li><li class="md-nav__item"><a href="#262-undo-functionality" title="2.6.2 Undo Functionality" class="md-nav__link">2.6.2 Undo Functionality</a></li><li class="md-nav__item"><a href="#263-back-end" title="2.6.3 Back-end" class="md-nav__link">2.6.3 Back-end</a></li></ul></nav></li></ul></nav></li><li class="md-nav__item"><a href="#3-user-accounts-and-sign-ins" title="3. User Accounts and Sign-ins" class="md-nav__link">3. User Accounts and Sign-ins</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#31-information-transfer" title="3.1 Information Transfer" class="md-nav__link">3.1 Information Transfer</a></li><li class="md-nav__item"><a href="#32-registration" title="3.2 Registration" class="md-nav__link">3.2 Registration</a></li><li class="md-nav__item"><a href="#33-logins" title="3.3 Logins" class="md-nav__link">3.3 Logins</a></li><li class="md-nav__item"><a href="#34-session-id" title="3.4 Session ID" class="md-nav__link">3.4 Session ID</a></li></ul></nav></li><li class="md-nav__item"><a href="#5-night-mode" title="5. Night Mode" class="md-nav__link">5. Night Mode</a></li><li class="md-nav__item"><a href="#6-conclusion-of-the-project" title="6. Conclusion of the Project" class="md-nav__link">6. Conclusion of the Project</a></li><li class="md-nav__item"><a href="#project-log" title="Project Log" class="md-nav__link">Project Log</a></li></ul></nav></div></div></div><div class="md-content"><article class="md-content__inner md-typeset"><h1 id="milestone-3">Milestone 3</h1>
<p><strong>Proposed Level of Achievement:</strong> Apollo 11</p>
<h2 id="1-site-design-revamped">1. Site Design Revamped</h2>
<p>We realised that the original design was a bit plain, so we decided to make
some changes to the site's UI.</p>
<ol>
<li>We removed the sidenav entirely as it only gave us issues viewing the
   platform on mobile, moving the sidenav links and elements to the topnav</li>
<li>All images used are either our own, or images sourced from this website
   <a href="https://www.pexels.com/search/food/">this website</a>.</li>
<li>In general, the site looks more appealing to the eye.</li>
</ol>
<h2 id="2-calorie-counter">2. Calorie Counter</h2>
<p>This was already shown in the prototype to work, there are however, a few
aspects that we would like to talk about in this section.</p>
<h3 id="21-typeaheadjs-technical-details">2.1 <code>typeahead.js</code> technical details</h3>
<p><div class="todo">
  <p>We didn't talk about this in MS2</p>
</div></p>
<h3 id="22-typeaheadjs-bug">2.2 <code>typeahead.js</code> bug</h3>
<p>Unbeknownst to us, the prototype shown in Milestone Two had a rather annoying
bug that presented itself when one added rows to the calorie counter. In order
to do input validation, we forced the user to select options from the
drop-down menu, using Twitter's <code>typeahead.js</code>:</p>
<div class="wrapper-center">
  <img src="../figures/ms3/typeahead_1.gif" alt="typeahead gif">
  <p>The recording software glitched a bit...</p>
</div>

<p>If multiple rows were added at the start, and users tried to select options
from the drop-down menu, they would have to click multiple times in order to
select that item properly. If the item was far down the drop-down menu, the
menu would refresh and brought back to the first entry. This made a menu
with many entries and selecting an item far down the menu an exercise in
frustration.</p>
<div class="wrapper-center">
  <img src="../figures/ms3/typeahead_2.gif" alt="typeahead 2 gif">
  <p>Five rows, so need to click five times</p>
</div>

<div class="todo">
  <p>TODO: How this was fixed</p>
</div>

<h3 id="23-input-validation">2.3 Input Validation</h3>
<p>A big part of simplifying the back-end was to restrict users in selecting
the ingredients. In order to do this, we simply made one of the fields
unselectable until the user clicked something from the drop-down menu, this
would trigger the <code>Please fill in all input fields</code> alert, forcing the user
to pick something from the drop-down menu.</p>
<h3 id="24-empty-rows">2.4 Empty Rows</h3>
<p>We received feedback that empty rows in the table would not allow the user to
submit the form using the "Analyze Calories" button. We originally forced the
user to fill in all input fields within the form in order to submit it using
a simple boolean check. We added in an additional <code>if</code> check to continue
processing the rest of the ingredients if an empty row was found.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">description</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">amount</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">unit</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="p">{</span>
  <span class="o">:</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>... Which we can abstract into a function such as:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">isAnEmptyRow</span><span class="p">()</span> <span class="p">{</span>
  <span class="o">:</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>This seemed to work well without issues.</p>
<h3 id="25-piechart-for-results">2.5 Piechart for Results</h3>
<p>The calorie counter now displays a piechart, giving users at a glance which
ingredients contributes the most to the overall caloric amount. This fulfilled
one of the features we wanted to add to the website.</p>
<p>For this feature, we used the
<a href="https://developers.google.com/chart/interactive/docs/gallery/piechart">Google Chart's API</a>
to render the chart.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">drawChart</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">google</span><span class="p">.</span><span class="nx">visualization</span><span class="p">.</span><span class="nx">arrayToDataTable</span><span class="p">(</span><span class="nx">breakdown</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;mode&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;dark&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;Breakdown&quot;</span><span class="p">,</span>
        <span class="nx">titleTextStyle</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;white&#39;</span>
        <span class="p">},</span>
        <span class="nx">legend</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">textStyle</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;white&#39;</span>
          <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">backgroundColor</span><span class="o">:</span> <span class="s1">&#39;#232b2b&#39;</span><span class="p">,</span>
        <span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;white&#39;</span>
      <span class="p">};</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;Breakdown&quot;</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">chart</span> <span class="o">=</span>
      <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">visualization</span><span class="p">.</span><span class="nx">PieChart</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;piechart&quot;</span><span class="p">));</span>
    <span class="nx">chart</span><span class="p">.</span><span class="nx">draw</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="26-saving-recipes-to-database">2.6 Saving Recipes to Database</h3>
<p>This feature was annoying and frustrating to implement, mostly due to the
handling of events by the Display and Delete buttons. Majority of the problems
faced were due to <code>async</code> on the front-end, rather than the back-end.</p>
<h4 id="261-front-end">2.6.1 Front-end</h4>
<p>We had a few versions of this page using vanilla Javascript and "doing
everything ourselves". But this proved to be very time-consuming and
frustrating to work with. In the end, we ended up going with the
<a href="https://datatables.net/">DataTables</a>
library, which allowed us to more easily create a table with additional
functionality, that also allowed styling via Bootstrap.</p>
<p>The table displays the <em>recipe name</em> and <em>number of calories</em> of each recipe
stored into the user account using the calorie counter. We give the users
two additional functionality in the form of two buttons in each row:</p>
<div class="md-typeset__scrollwrap">
  <div class="md-typeset__table">
    <table>
      <thead>
        <tr>
          <th align="center">Button</th>
          <th align="center">Function</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td align="center" class="details-control"></td>
          <td align="left">
            Shows more information abouyt the recipe. This uses DataTable's
            <a href="https://datatables.net/examples/api/row_details.html">child rows</a>
            API, where more information can be dynamically inserted into the
            table
          </td>
        </tr>
        <tr>
          <td align="center" class="details-delete"></td>
          <td align="left">
            Deletes the recipe from the table (and database). While DataTable's
            does offer an API to delete rows from the table, we needed to
            handle reinserting the same row into the table for the "Undo"
            feature ourselves.
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<h5 id="delete">"Delete"</h5>
<p>The "delete" functionality posed some challenges for us. First, <code>ajax</code> requests
are asynchronous, and so making an <code>ajax</code> call every time the user deletes
something caused some problems with the code (functions not returning until
<code>ajax</code> request has finished, causing <code>null</code> in some variables, etc). So, we
ended up storing the names of the recipes that were to be deleted in an
array (a "fake" delete, as it were), and executing an <code>ajax</code> request to delete
all the recipes from the database once the page is unloaded.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;unload&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">toDelete</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span><span class="s2">&quot;/delete_recipe_data&quot;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
      <span class="nx">contentType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
      <span class="nx">dataType</span><span class="o">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
      <span class="nx">data</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
        <span class="s2">&quot;recipeName&quot;</span><span class="o">:</span> <span class="nx">toDelete</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
      <span class="p">})</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</td></tr></table>

<p>It also turned out that doing this method made the <code>undo</code> button easier to
implement as well.</p>
<h4 id="262-undo-functionality">2.6.2 Undo Functionality</h4>
<p>We felt that an <code>undo</code> option is very important for users. This is from
experience of frequently using <code>Ctrl-Shift-T</code> to reopen closed tabs on browsers,
or <code>Ctrl-Z</code> in most programs. We used Bootstrap alerts to create a way for
users to "Undo" a delete they may have accidentally clicked, such as:</p>
<div class="alert alert-warning alert-dismissible fade show" role="alert">
  Deleted "recipe_name".
  <button type="button" class="btn btn-link btn-sm">
    Undo
  </button>
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>

<p>This allows the users to Undo the delete if it was by accident, or if the user
had a change of heart.</p>
<h4 id="263-back-end">2.6.3 Back-end</h4>
<p>Flask has a <code>jsonify()</code> method to pass JSON objects back to the
front-end Javascript. Conversely, Javascript's jQuery has the ability to make
an <code>ajax</code> request to the Python back-end to send data back. This is how the
front-end communicates with the SQL database in the back-end. So, to send
data back to the back-end, an <code>ajax</code> request may look something like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">...;</span> <span class="c1">// recipe data goes here</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span><span class="s2">&quot;/func_name&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
    <span class="nx">contentType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
    <span class="nx">dataType</span><span class="o">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="p">}).</span><span class="nx">done</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// do something after function returns</span>
<span class="p">})</span>
</pre></div>
</td></tr></table>

<p>When the Python function returns from the back-end, <code>.done()</code> is used to
continue the running of the Javascript after the <code>ajax</code> request is finished.</p>
<p>In the back-end, the Python function looks like:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&quot;/func_name&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">func_name</span><span class="p">:</span>
  <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
      <span class="c1"># make SQL requests and deletes from database</span>
  <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;my_page.html&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Due to the way we delete recipes form the database, we do not allow
duplicate recipe names inside the database. This is done using an SQL
<code>SELECT</code> first:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">exists</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT 1 FROM recipes</span>
<span class="s2">        WHERE username = (?) AND recipe_name = (?)&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">recipe_name</span><span class="p">))</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<p>Then check <code>if (exists)</code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">exists</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="s2">&quot;Recipe already exists&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;INSERT INTO recipes</span>
<span class="s2">            (username, recipe_name, recipe, calories)</span>
<span class="s2">            VALUES(?, ?, ?, ?)&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">recipe_name</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">calories</span><span class="p">))</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="s2">&quot;Recipe saved&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h2 id="3-user-accounts-and-sign-ins">3. User Accounts and Sign-ins</h2>
<p>User Accounts and Sign-ins were a big part of how we implemented certain
functions within the webapp. Flask has a framework for User Accounts already
available.</p>
<h3 id="31-information-transfer">3.1 Information Transfer</h3>
<p>Passing username/passwords back and forth between the front and back-end was
done using HTTPS POST requests. We read that this is standard for web
security nowadays due to HTTPS encryption to prevent MiTM attacks.</p>
<h3 id="32-registration">3.2 Registration</h3>
<p>While we initially intended to work with Firebase to do Google/Facebook
Sign-ins due to the ease of implementation and security in having established
third-parties handle authentications for us, 
we decided against this because we wanted to appreciate the
difficulty and security considerations with storing usernames, passwords
and doing secure serverside authentication, and how big of a topic it is in
web security.</p>
<p>We used Flask's <a href="https://pypi.org/project/Werkzeug/">Werkzeug</a> library to
handle password hashing and salting. Hashing ensures that we do not store
passwords in plaintext, while salting ensures that similar passwords don't
result in the same hash. For example, I made two accounts with the following
usernames and passwords</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>user        password
====================
hashed1     123456
hashed2     123456
</pre></div>
</td></tr></table>

<p>The two passwords were hashed and salted to:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>hashed1:
pbkdf2:sha256:150000$QBDEP5Jn$3001b4fb44eeb17630b6d9a0089f9b883686bd6ea9a61cec1f8b1ae0ade8e05e

hashed2:
pbkdf2:sha256:150000$0o18iF5N$7c406da90ce724f65c896fe931f9bda806fb3f04b55e21d1f9f0f88488b47385
</pre></div>
</td></tr></table>

<p>... making it more secure. In the back-end, our code is simply -</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">hashed_password</span> <span class="o">=</span> <span class="n">generate_password_hash</span><span class="p">(</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">])</span>
</pre></div>
</td></tr></table>

<h3 id="33-logins">3.3 Logins</h3>
<p>Logins were simple. We simply sent the username and password back to the
back-end, and uses Werkzeug's <code>check_password_hash()</code> function to check if the
given password matched the hashed password in our database. If it matches,
it logs the user in and redirects the user to the front-page.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">form</span><span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">]</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">form</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">]</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ROOT</span><span class="p">,</span> <span class="s2">&quot;slim_jeans.db&quot;</span><span class="p">))</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT * FROM users WHERE username = (?)&quot;&quot;&quot;</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">username</span><span class="p">,))</span>
    <span class="n">userInformation</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">userInformation</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> \
        <span class="ow">not</span> <span class="n">check_password_hash</span><span class="p">(</span><span class="n">userInformation</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">password</span><span class="p">):</span>
        <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Invalid username and/or password&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;login.html&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">userInformation</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">session</span><span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">userInformation</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;login.html&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h3 id="34-session-id">3.4 Session ID</h3>
<!-- Please explain this section -->

<h2 id="5-night-mode">5. Night Mode</h2>
<h2 id="6-conclusion-of-the-project">6. Conclusion of the Project</h2>
<p>We would say that we have learnt greatly from Orbital, particularly the
many APIs and frameowrks (and lack thereof) we have had the pleasure of using,
such as Flask, Jinja2, SQLite, etc and the other technologies such as HTML5,
CSS and native Javascript.</p>
<p>Doing this project using native Javascript has
also allowed us to appreciate new web frameworks such as React,
Vue or Angular that abstracts the nitty-gritty of direct DOM
manipulation and state changes. Even trying to creat and insert a table
into a webpage is long-winded and cumbersome to do!</p>
<p>No matter what level of achievement we end up obtaining for Orbital, this
has been a fruitful and memorable project.</p>
<h2 id="project-log">Project Log</h2>
<p>Our project log is documented
<a href="https://docs.google.com/spreadsheets/d/17kEtNaCyYZzXc2UWd6ss4zXTWQ4-QY7XN3ODB6DpEJs/edit?usp=sharing">in this Google Sheet</a></p></article></div></div></main><footer class="md-footer"><div class="md-footer-nav"><nav class="md-footer-nav__inner md-grid"><a href="../milestone_two/" title="Two" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev"><div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-back md-footer-nav__button"></i></div><div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class="md-flex__ellipsis"><span class="md-footer-nav__direction">Previous</span>Two</span></div></a></nav></div><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class="md-footer-copyright">powered by <a href="https://www.mkdocs.org">MkDocs</a> and <a href="https://squidfunk.github.io/mkdocs-material/">Material for MkDocs</a></div></div></div></footer></div><script src="../assets/javascripts/application.b260a35d.js"></script><script>app.initialize({version:"1.0.4",url:{base:".."}})</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>